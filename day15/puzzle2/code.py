import sys
sys.path.append('../')
sys.path.append('../../')

import re
import math
import pprint

from utils import *

instances = [
    {
        'input': '''\
#######
#...#.#
#.....#
#..OO@#
#..O..#
#.....#
#######

<vv<<^^<<^^''',
    'expanded_map': '''\
##############
##......##..##
##..........##
##....[][]@.##
##....[]....##
##..........##
##############''',    
    'final_map': '''\
##############
##...[].##..##
##...@.[]...##
##....[]....##
##..........##
##..........##
##############''',
    'sum_of_boxes_GPS_coordinates': 105 + 207 + 306,
    },
    {
        'input': '''\
##########
#..O..O.O#
#......O.#
#.OO..O.O#
#..O@..O.#
#O#..O...#
#O..O..O.#
#.OO.O.OO#
#....O...#
##########

<vv>^<v^>v>^vv^v>v<>v^v<v<^vv<<<^><<><>>v<vvv<>^v^>^<<<><<v<<<v^vv^v>^
vvv<<^>^v^^><<>>><>^<<><^vv^^<>vvv<>><^^v>^>vv<>v<<<<v<^v>^<^^>>>^<v<v
><>vv>v^v^<>><>>>><^^>vv>v<^^^>>v^v^<^^>v^^>v^<^v>v<>>v^v^<v>v^^<^^vv<
<<v<^>>^^^^>>>v^<>vvv^><v<<<>^^^vv^<vvv>^>v<^^^^v<>^>vvvv><>>v^<<^^^^^
^><^><>>><>^^<<^^v>>><^<v>^<vv>>v>>>^v><>^v><<<<v>>v<v<v>vvv>^<><<>^><
^>><>^v<><^vvv<^^<><v<<<<<><^v<<<><<<^^<v<^^^><^>>^<v^><<<^>>^v<v^v<v^
>^>>^v>vv>^<<^v<>><<><<v<<v><>v<^vv<<<>^^v^>^^>>><<^v>>v^v><^^>>^<>vv^
<><^^>^^^<><vvvvv^v<v<<>^v<v>v<<^><<><<><<<^^<<<^<<>><<><^^^>^^<>^>v<>
^^>vv<^v^v<vv>^<><v<^v>^^^>>>^^vvv^>vvv<>>>^<^>>>>>^<<^v>^vvv<>^<><<v>
v^^>>><<^^<>>^v^<v^vv<>v^<<>^<^v^v><^<<<><<^<v><v<>vv>>v><v^<vv<>v^<<^''',
    'expanded_map': '''\
####################
##....[]....[]..[]##
##............[]..##
##..[][]....[]..[]##
##....[]@.....[]..##
##[]##....[]......##
##[]....[]....[]..##
##..[][]..[]..[][]##
##........[]......##
####################''',
    'final_map': '''\
####################
##[].......[].[][]##
##[]...........[].##
##[]........[][][]##
##[]......[]....[]##
##..##......[]....##
##..[]............##
##..@......[].[][]##
##......[][]..[]..##
####################''',
    'sum_of_boxes_GPS_coordinates': 9021,
    },
    {
        'input': "../puzzle1/input.txt",
    },
]

attrs = [
    'expanded_map',
    'final_map',
    'sum_of_boxes_GPS_coordinates',
    ]

def solve( instance ):
    SPACE_CHAR = '.'
    SPACE_ID   = -1
    WALL_CHAR  = '#'
    WALL_ID    = -2
    ROBOT_CHAR = '@'
    ROBOT_ID   = -3
    BOX_SINGLE_CHAR = 'O'
    BOX_LEFT_CHAR   = '['
    BOX_RIGHT_CHAR  = ']'
    BOX_RIGHT_ID    = -4

    def parse_and_expand_input( input ):
        # If the tile is #, the new map contains ## instead.
        # If the tile is O, the new map contains [] instead.
        # If the tile is ., the new map contains .. instead.
        # If the tile is @, the new map contains @. instead.

        int_yx_array = []
        boxes = []
        move_directions = []
        robot_coord = None

        strs = get_array_of_strings_from_input( input )
        for y, str in enumerate(strs):
            if str.startswith('#'): # #..O..O.O#
                chars = list(str)
                row = []
                for x, char in enumerate(chars):
                    if char == WALL_CHAR:
                        row.append( WALL_ID )
                        row.append( WALL_ID )
                    elif char == ROBOT_CHAR: # 
                        row.append( ROBOT_ID )
                        robot_coord = (x*2,y)
                        row.append( SPACE_ID )
                    elif char == BOX_SINGLE_CHAR:
                        box = {'coord': (x*2,y), 'id': len(boxes)}
                        boxes.append( box )
                        row.append( box['id'] )
                        row.append( BOX_RIGHT_ID )
                    elif char == SPACE_CHAR:
                        row.append( SPACE_ID )  
                        row.append( SPACE_ID )  
                    else:
                        assert False, f"Unknown char: {char}"
                int_yx_array.append( row )
            elif str == '':
                continue
            else:
                direction_arrows = list(str)
                for da in direction_arrows:
                    direction = direction_by_char_arrow[da]
                    move_directions.append( direction )
        return int_yx_array, boxes, move_directions, robot_coord

    int_yx_array, boxes, move_directions, robot_coord = parse_and_expand_input( instance['input'] )

    def construct_map( int_yx_array, robot_coord ):
        row_strs = []
        for y, row in enumerate(int_yx_array):
            char_row = []
            for x, cell in enumerate(row):
                if (x,y) == robot_coord:
                    char_row.append( ROBOT_CHAR )
                elif cell == WALL_ID:
                    char_row.append( WALL_CHAR )
                elif cell == SPACE_ID:
                    char_row.append( SPACE_CHAR )
                elif cell == BOX_RIGHT_ID:
                    char_row.append( BOX_RIGHT_CHAR )
                else:
                    char_row.append( BOX_LEFT_CHAR )
            row_strs.append( ''.join(char_row) )    
        
        str = '\n'.join(row_strs)
        return str

    expanded_map = construct_map( int_yx_array, robot_coord )

    def move_robot_in_direction( direction, int_yx_array, boxes, robot_coord, step_i ):
        dx, dy = coord_delta_by_direction[direction]
        # print( f"step_i: {step_i}, direction: {direction}, dx,dy: {dx,dy}, robot_coord: {robot_coord}" )
        box_ids_to_move = []
        is_space_to_move_to = False
        coords_needing_space_to_move_to = [robot_coord]

        while True:
            # check if any coords hit a wall
            hit_a_wall = False
            for coord in coords_needing_space_to_move_to:
                x,y = coord
                new_x, new_y = x+dx, y+dy
                if int_yx_array[new_y][new_x] == WALL_ID:
                    hit_a_wall = True
                    break
            if hit_a_wall:
                break

            # check if any coords hit a box
            # differently for each direction
            new_coords_needing_space_to_move_to = []

            if direction == 0: # e
                assert len(coords_needing_space_to_move_to) == 1
                assert dx == 1
                assert dy == 0
                x,y = coords_needing_space_to_move_to[0]
                new_x, new_y = x+dx, y+dy
                cell = int_yx_array[new_y][new_x]
                if cell >= 0:
                    box_ids_to_move.append( cell )
                    new_coords_needing_space_to_move_to.append( (new_x+1, new_y) ) # NB cell +1 to right
                elif cell == SPACE_ID:
                    pass
                else:
                    assert False, f"Unknown cell: {cell}"
            elif direction == 2: # w
                assert len(coords_needing_space_to_move_to) == 1
                assert dx == -1
                assert dy == 0
                x,y = coords_needing_space_to_move_to[0]
                new_x, new_y = x+dx, y+dy
                cell = int_yx_array[new_y][new_x]
                if cell == BOX_RIGHT_ID:
                    box_x = new_x -1
                    box_y = new_y
                    box_cell = int_yx_array[box_y][box_x]
                    if box_cell < 0:
                        temp_map = construct_map( int_yx_array, robot_coord )
                        pprint.pp( {
                            'step_i': step_i,
                            'temp_map': temp_map, 
                            'direction': direction, 
                            'x,y': (x,y),
                            'new_x,new_y': (new_x,new_y),
                            'cell': cell,
                            'box_x, box_y': (box_x, box_y),
                            'box_cell': box_cell,
                            })
                    assert box_cell >= 0
                    box_ids_to_move.append( box_cell )
                    new_coords_needing_space_to_move_to.append( (box_x, box_y) )
                elif cell == SPACE_ID:
                    pass
                else:
                    assert False, f"Unknown cell: {cell}"
            elif direction == 1 or direction == 3: # s or n
                for coord in coords_needing_space_to_move_to:
                    assert dx == 0
                    assert abs(dy) == 1
                    x,y = coord
                    new_x, new_y = x+dx, y+dy
                    cell = int_yx_array[new_y][new_x]
                    if cell >= 0: # is a box cell left
                        if cell in box_ids_to_move:
                            continue
                        box_ids_to_move.append( cell )
                        new_coords_needing_space_to_move_to.append( (new_x, new_y) )
                        new_coords_needing_space_to_move_to.append( (new_x+1, new_y) )
                    elif cell == BOX_RIGHT_ID:
                        box_cell_left = int_yx_array[new_y][new_x-1]
                        assert box_cell_left >= 0
                        if box_cell_left in box_ids_to_move:
                            continue
                        box_ids_to_move.append( box_cell_left )
                        new_coords_needing_space_to_move_to.append( (new_x-1, new_y) )
                        new_coords_needing_space_to_move_to.append( (new_x, new_y) )
                    elif cell == SPACE_ID:
                        pass
                    else:
                        assert False, f"Unknown cell: {cell}"
            else:   
                assert False, f"Unknown direction: {direction}"

            coords_needing_space_to_move_to = new_coords_needing_space_to_move_to

            if len(coords_needing_space_to_move_to) == 0:
                is_space_to_move_to = True
                break

        if is_space_to_move_to:
            # move boxes in reverse order, then robot
            for box_id in reversed(box_ids_to_move):
                box = boxes[box_id]
                x, y = box['coord']
                new_x, new_y = x+dx, y+dy
                box['coord'] = (new_x, new_y)

                int_yx_array[y][x] = SPACE_ID
                int_yx_array[y][x+1] = SPACE_ID
                int_yx_array[new_y][new_x] = box_id
                int_yx_array[new_y][new_x+1] = BOX_RIGHT_ID

            x, y = robot_coord
            new_x, new_y = x+dx, y+dy
            robot_coord = (new_x, new_y)
            int_yx_array[y][x] = SPACE_ID
            int_yx_array[new_y][new_x] = ROBOT_ID
        
        return int_yx_array, boxes, robot_coord, is_space_to_move_to

    # prev_temp_snapshot = None
    for step_i, direction in enumerate(move_directions):
        int_yx_array, boxes, robot_coord, is_space_to_move_to = move_robot_in_direction( direction, int_yx_array, boxes, robot_coord, step_i )
        # temp_map = construct_map( int_yx_array, robot_coord )
        # temp_snapshot = {
        #     'step_i': step_i,
        #     'temp_map': temp_map, 
        #     'direction': direction, 
        #     'is_space_to_move_to': is_space_to_move_to,
        #     'robot_coord': robot_coord,
        #     }
        # if ']]' in temp_map:
        #     pprint.pp( {
        #         'temp_snapshot': temp_snapshot,
        #         'prev_temp_snapshot': prev_temp_snapshot,
        #         })
        # assert ']]' not in temp_map
        # prev_temp_snapshot = temp_snapshot

    final_map = construct_map( int_yx_array, robot_coord )

    gps_scores= []
    for box in boxes:
        x, y = box['coord']
        gps_scores.append( x + 100*y )

    sum_of_boxes_GPS_coordinates = sum(gps_scores)

    return {
        'expanded_map': expanded_map,
        'final_map': final_map,
        'sum_of_boxes_GPS_coordinates': sum_of_boxes_GPS_coordinates,
    }

def run():
    print_here()
    verbose = True
    response = exercise_fn_with_cases( solve, instances, attrs, verbose )
    if verbose:
        pprint.pp( response )
    else:
        print( response )

if __name__ == "__main__":
    run()

# AOC 2024: 2024-12-23: day15/puzzle2/..
# [{'elapsed_time_s': 0.00016395887359976768},
#  {'elapsed_time_s': 0.012809459120035172},
#  {'expanded_map': '####################################################################################################\n'
#                   '##[]..[]..[]..[]..............[]..##[]......[]..[][]..[]..##....[]....[]..........[][]..[]........##\n'
#                   '##[]..[]..[]....[]..[][][]..[]............[]....[][]....##[]..[]........[]..[]##....[]....[][]....##\n'
#                   '##..[]..[]........[][]..[][]..........[][][]..............[]........................[][]..[]......##\n'
#                   '##..............[]..##..[][]....##[]..[]........[]....[][]..[]....................[]##....[]....####\n'
#                   '##........[]......[]..........[]##........[]..[]......##..[]..[]....[]....##........##..........####\n'
#                   '##..[]..##..[]....[]..[][]..[]..[]..[][]....[]##....##[]......[]####........##..[]..[]....[]....[]##\n'
#                   '##....[][]..####[]....[]........##..[][][]..[]##[]....[]......##..[]....[]..[]..[][]....[][]......##\n'
#                   '##..##............[]####........[]..[]....[]........[]....[][][][]............[]..##[]##......##..##\n'
#                   '##..............##[]..##........[][]........[]........[][]........[][]##..##............[][][]....##\n'
#                   '##..##....##..[]........[][]..##..............[][]................[]..[]......##....[][][]......####\n'
#                   '##....[]....[]......[][]##..............[]....##[]......##....[][]....[]....##..##....##....[]....##\n'
#                   '##[]##......[]..##[]..[][][]..[]....[][][]..............##............[]##[]..[][]......##......[]##\n'
#                   '##..##[]..##......####[]..[][]....######..[]....[]##....[]......[][]....[]..........[][][]##..##..##\n'
#                   '####................[]..##..[]............[]............####............[]....[][]......[]..[]....##\n'
#                   '##............[]..[][]....[]..............[]......[]..[]##[]..............[]......[][]..[]....[]..##\n'
#                   '##..[]........##..[]..................[]..........[]............[][]........[][]..[][][]....[]##..##\n'
#                   '##....[]##....[]........[][][][]..[]..[]............[][]........[]..........[]##[][]....##[]......##\n'
#                   '######[][]..[]..........[][][]..........[][]##..........[]........[][][][]..##....[]##....####[]..##\n'
#                   '##..[]..........[]..##..##[][]..##..[]................[]............##[]......##......##..[][]....##\n'
#                   '##....[]....................[]......[]..##..##..[][]##........................[][]##..##....[]....##\n'
#                   '##............[]..........[]..[]....[]....[][]....[]......[]........[][]..[]####....[]..........[]##\n'
#                   '##[]##..##....##....[]......[]##..####[]##..[]##....##....[]..[][]..................[][]....####..##\n'
#                   '##....[]....[]####[][]..##..##........[]..##[]..............[][]..[]........[]..[]..[]....##......##\n'
#                   '##[][]....##............##..####[][][][]........@.....[][]..[]......[]..[]......[][][][]........[]##\n'
#                   '##....[][][]....##......[][]....####[]..[]......##..........[]......[]##......[]..[]....[]..##..[]##\n'
#                   '####......[][]................[]..##....##............[]..[]............[]....##..[]..........[]####\n'
#                   '##......##........[]..##....[][]..[]........##..[]####..[]......##....##[]................[]....[]##\n'
#                   '##[]..[][]....[]....[]..##..[]......[]....##[]......[]..[]....[]........[]..[]..[]....[]..##..[]..##\n'
#                   '##......[]......[]......[]........[]......[]..[]........##......[]..[]....[][]........[]..[]....[]##\n'
#                   '##[][]##..##[]....[][][]..##[]..[]....[]......[]..[][]....[][]..............[]..................[]##\n'
#                   '##......[][][][]..[][]##................[]..##..........##..[][]..[]......[]......[]........[][]..##\n'
#                   '##[]..[]....[]....[][][]..[]......[][]..........[]....##[]....[][]............[]..............[]..##\n'
#                   '##..[]..[]....[][]##....##........[]............................[]..##....[]..........[]..[]##....##\n'
#                   '##..[]....[][]..............[]............[]..........[]..[]##[]..##....[]..[]##..[][]..........[]##\n'
#                   '##................[][]..[]##....[]........[]..............##[]............##[]##[]........[]..[][]##\n'
#                   '##[]..##..##[]..........##....##....##..##....[]..##....##..[]..##[]..##..[]..[]........[]##[]....##\n'
#                   '##[]##........[]..........[]..##..##[][]....[]....##[][]........[]........##[]..[]..........[]....##\n'
#                   '##[][]##....##..[][][][][]..............##........##..[]##....[][]............[][]......[]..##..[]##\n'
#                   '##..[]##......[]..................[]..[]..........[]..[]....[]....[]....[][]............[][]......##\n'
#                   '##....[]....[]##[]..[]..[][]..........[][][][]..[]......[][]..[][]##[]............[]##....##..[]..##\n'
#                   '##[][]..##[][][]............[]....##[][][][][]##........##......[]..##..[]##......[][]..[]..[]..[]##\n'
#                   '##..[]..[]##........##[]................[]....##[]..[]........[]............[]..[][]......##....[]##\n'
#                   '##..................[][]....[]............[]..............[]..####..........................[]....##\n'
#                   '##........##..[]..[][]..[]..........##..[][]..[]....[]##[][][]..........##..[]..[]..##......[]....##\n'
#                   '##..[][]..........................##........[][]..##[][]........[][]##........[]........[][][][]..##\n'
#                   '##[]..[]..[]..................[]##....[][]..............[][]..[]....##....[]....[]......[]..[]..[]##\n'
#                   '##......[][]......##[]..####[][][]........[]..........##....[]........##[]......[][][]##[]..[]....##\n'
#                   '##..[]....####..[][]........####..........##..........[]..........[][]..[]....##..##[][]##[][]..[]##\n'
#                   '####################################################################################################',
#   'final_map': '####################################################################################################\n'
#                '##[]..[]..[]..[]......[][][][][][]##[][][][]....[].[][][].##.[][]..[][].....[][]..[][]..[][]......##\n'
#                '##[]..[]..[].[][].......[][][][][].[][].............[][]##[].[]....[][].......##..[][]..[][][]....##\n'
#                '##.[][][]..............[][][][]....[]....................[].........................[][][][]......##\n'
#                '##..................##...[].....##[]..........................[]....................##.......[].####\n'
#                '##........[]....................##.......[]...[]......##......[][]........##........##.[].[]....####\n'
#                '##..[]..##[]........[]..........[]............##....##[]......[]####......[]##[]...[]........[].[]##\n'
#                '##.......[].####...[]..[].......##............##...[].........##[]..........[]....[]..[]....[]....##\n'
#                '##..##@.........[][]####[]......[][].........[][]............[][]..........[].....##..##....[]##..##\n'
#                '##..............##[]..##[]........[][].[]..............[].....[]......##..##...[]....[]...........##\n'
#                '##..##....##..[]......[][]....##.....[].[]............[].[][][][]...[]......[]##[]..............####\n'
#                '##..........[]......[][]##..........[][]......##........##[][]..[]..........##..##....##..........##\n'
#                '##[]##......[]..##[].[][]............[].............[]..##[][].[].......##..[]......[][]##........##\n'
#                '##..##....##......####[]..........######..[]......##.......[]...[]................[][][][]##..##[]##\n'
#                '####................[]..##...[].........[][].......[][].####.........[]...........[][]..........[]##\n'
#                '##............[]..[][]....................[][]........[]##[].....................[].[].........[].##\n'
#                '##..[][]......##..[].................[]..[][].........[][]....[].......[].........[][][][]....##..##\n'
#                '##....[]##....[]........[].[]..............[]........[].[]..............[]..[]##.[][]...##[][]....##\n'
#                '######[][]..[].....[][][].[]...[]...........##..........[]............[]....##....[]##[]..####[]..##\n'
#                '##..[][]........[]..##..##[][][]##.......[]...........[]...[].....[]##......[]##..[]..##..[][]....##\n'
#                '##....[]....................[]......[]..##[]##..[]..##.....[].............[]..[]..##..##....[]....##\n'
#                '##....[]......[]..........[][][]..[]...[][][][].......[][][]................####....[]..........[]##\n'
#                '##[]##..##....##....[]......[]##..####..##..[]##....##[]..[]........................[][]....####..##\n'
#                '##....[]....[]####[][]..##..##............##[]............[]................[]..[]..[]....##......##\n'
#                '##[][]....##............##..####[][][]..................................[][][]..[][][][]........[]##\n'
#                '##....[][][]....##......[][]....####[].[].......##....................##.[][].[][][]....[]..##..[]##\n'
#                '####......[][]................[]..##..[]##............[]...............[][]...##[][]..........[]####\n'
#                '##......##........[]..##....[][]..[]..[]..[]##..[]####.[][].....##....##[]......[].....[].[]....[]##\n'
#                '##[]..[][]....[]....[]..##..[]......[][]..##[].....[]...[].[]......[]..........[][][]..[].##..[][]##\n'
#                '##......[]......[]......[]........[]..[]..[]..[]..[]....##.[].....[]..........[]..[]......[]....[]##\n'
#                '##[][]##..##[]....[][][]..##[]..[]....[]......[].[].................[]......[]....[]..........[][]##\n'
#                '##......[][][][]..[][]##..............[][]..##........[]##....[]......[]....[]................[][]##\n'
#                '##[]..[]....[]....[][][]..[]......[][][]........[]....##[].........[].........[]..............[][]##\n'
#                '##..[]..[]....[][]##....##........[]..........................[]..[]##......[]..............##[]..##\n'
#                '##..[]....[][]..............[]............[]..............[]##[]..##[]..[][][]##[]...........[]...##\n'
#                '##................[][]..[]##....[]........[]..............##[][]........[]##[]##[]....[]..[]......##\n'
#                '##[]..##..##[]..........##....##....##..##....[]..##..[]##....[]##....##...[][][].........##......##\n'
#                '##[]##........[]..........[]..##..##[][]....[]....##..[]..................##[][][]................##\n'
#                '##[][]##....##..[][][][][]..............##........##..[]##[][][]..[].........[][]...[]..[]..##....##\n'
#                '##..[]##......[]..................[]..[]........[][].[]......[].....[]............[]..[][]........##\n'
#                '##....[]....[]##[]..[]..[][]..........[][][][].........[][][].[][]##[].....[].....[]##..[]##......##\n'
#                '##[][]..##[][][]............[]....##[][][][][]##........##.....[]...##....##.........[][][].......##\n'
#                '##..[]..[]##........##[]................[]....##[]..[]....[]..[]........[]................##......##\n'
#                '##..................[][]....[]............[]..............[][]####.....[]...................[][]..##\n'
#                '##........##..[]..[][]..[]..........##..[][]..[]....[]##...[]...........##..........##......[][][]##\n'
#                '##..[][]..........................##........[][]..##[][]............##....[]............[][][][][]##\n'
#                '##[]..[]..[]..................[]##....[][]..........[]............[]##[]..........[]....[]..[]..[]##\n'
#                '##......[][]......##[]..####[][][]........[]..........##[]..[]..[]....##[]........[][]##[]..[]..[]##\n'
#                '##..[]....####..[][]........####..........##..........[][]......[][][].[].....##[]##[][]##[][]..[]##\n'
#                '####################################################################################################',
#   'sum_of_boxes_GPS_coordinates': 1519991,
#   'elapsed_time_s': 7.582038125023246}]
# chrisgathercole@Chriss-MacBook-Air puzzle2 % /Users/chrisgathercole/.pyenv/versions/3.12.1/bin/python /Users/chrisgathercole/dev/advent-of-code-2024/day15/puzzle2/code.
# py
# AOC 2024: 2024-12-23: day15/puzzle2/..
# [{'elapsed_time_s': 6.091711111366749e-05},
#  {'elapsed_time_s': 0.0005215001292526722},
#  {'expanded_map': '####################################################################################################\n'
#                   '##[]..[]..[]..[]..............[]..##[]......[]..[][]..[]..##....[]....[]..........[][]..[]........##\n'
#                   '##[]..[]..[]....[]..[][][]..[]............[]....[][]....##[]..[]........[]..[]##....[]....[][]....##\n'
#                   '##..[]..[]........[][]..[][]..........[][][]..............[]........................[][]..[]......##\n'
#                   '##..............[]..##..[][]....##[]..[]........[]....[][]..[]....................[]##....[]....####\n'
#                   '##........[]......[]..........[]##........[]..[]......##..[]..[]....[]....##........##..........####\n'
#                   '##..[]..##..[]....[]..[][]..[]..[]..[][]....[]##....##[]......[]####........##..[]..[]....[]....[]##\n'
#                   '##....[][]..####[]....[]........##..[][][]..[]##[]....[]......##..[]....[]..[]..[][]....[][]......##\n'
#                   '##..##............[]####........[]..[]....[]........[]....[][][][]............[]..##[]##......##..##\n'
#                   '##..............##[]..##........[][]........[]........[][]........[][]##..##............[][][]....##\n'
#                   '##..##....##..[]........[][]..##..............[][]................[]..[]......##....[][][]......####\n'
#                   '##....[]....[]......[][]##..............[]....##[]......##....[][]....[]....##..##....##....[]....##\n'
#                   '##[]##......[]..##[]..[][][]..[]....[][][]..............##............[]##[]..[][]......##......[]##\n'
#                   '##..##[]..##......####[]..[][]....######..[]....[]##....[]......[][]....[]..........[][][]##..##..##\n'
#                   '####................[]..##..[]............[]............####............[]....[][]......[]..[]....##\n'
#                   '##............[]..[][]....[]..............[]......[]..[]##[]..............[]......[][]..[]....[]..##\n'
#                   '##..[]........##..[]..................[]..........[]............[][]........[][]..[][][]....[]##..##\n'
#                   '##....[]##....[]........[][][][]..[]..[]............[][]........[]..........[]##[][]....##[]......##\n'
#                   '######[][]..[]..........[][][]..........[][]##..........[]........[][][][]..##....[]##....####[]..##\n'
#                   '##..[]..........[]..##..##[][]..##..[]................[]............##[]......##......##..[][]....##\n'
#                   '##....[]....................[]......[]..##..##..[][]##........................[][]##..##....[]....##\n'
#                   '##............[]..........[]..[]....[]....[][]....[]......[]........[][]..[]####....[]..........[]##\n'
#                   '##[]##..##....##....[]......[]##..####[]##..[]##....##....[]..[][]..................[][]....####..##\n'
#                   '##....[]....[]####[][]..##..##........[]..##[]..............[][]..[]........[]..[]..[]....##......##\n'
#                   '##[][]....##............##..####[][][][]........@.....[][]..[]......[]..[]......[][][][]........[]##\n'
#                   '##....[][][]....##......[][]....####[]..[]......##..........[]......[]##......[]..[]....[]..##..[]##\n'
#                   '####......[][]................[]..##....##............[]..[]............[]....##..[]..........[]####\n'
#                   '##......##........[]..##....[][]..[]........##..[]####..[]......##....##[]................[]....[]##\n'
#                   '##[]..[][]....[]....[]..##..[]......[]....##[]......[]..[]....[]........[]..[]..[]....[]..##..[]..##\n'
#                   '##......[]......[]......[]........[]......[]..[]........##......[]..[]....[][]........[]..[]....[]##\n'
#                   '##[][]##..##[]....[][][]..##[]..[]....[]......[]..[][]....[][]..............[]..................[]##\n'
#                   '##......[][][][]..[][]##................[]..##..........##..[][]..[]......[]......[]........[][]..##\n'
#                   '##[]..[]....[]....[][][]..[]......[][]..........[]....##[]....[][]............[]..............[]..##\n'
#                   '##..[]..[]....[][]##....##........[]............................[]..##....[]..........[]..[]##....##\n'
#                   '##..[]....[][]..............[]............[]..........[]..[]##[]..##....[]..[]##..[][]..........[]##\n'
#                   '##................[][]..[]##....[]........[]..............##[]............##[]##[]........[]..[][]##\n'
#                   '##[]..##..##[]..........##....##....##..##....[]..##....##..[]..##[]..##..[]..[]........[]##[]....##\n'
#                   '##[]##........[]..........[]..##..##[][]....[]....##[][]........[]........##[]..[]..........[]....##\n'
#                   '##[][]##....##..[][][][][]..............##........##..[]##....[][]............[][]......[]..##..[]##\n'
#                   '##..[]##......[]..................[]..[]..........[]..[]....[]....[]....[][]............[][]......##\n'
#                   '##....[]....[]##[]..[]..[][]..........[][][][]..[]......[][]..[][]##[]............[]##....##..[]..##\n'
#                   '##[][]..##[][][]............[]....##[][][][][]##........##......[]..##..[]##......[][]..[]..[]..[]##\n'
#                   '##..[]..[]##........##[]................[]....##[]..[]........[]............[]..[][]......##....[]##\n'
#                   '##..................[][]....[]............[]..............[]..####..........................[]....##\n'
#                   '##........##..[]..[][]..[]..........##..[][]..[]....[]##[][][]..........##..[]..[]..##......[]....##\n'
#                   '##..[][]..........................##........[][]..##[][]........[][]##........[]........[][][][]..##\n'
#                   '##[]..[]..[]..................[]##....[][]..............[][]..[]....##....[]....[]......[]..[]..[]##\n'
#                   '##......[][]......##[]..####[][][]........[]..........##....[]........##[]......[][][]##[]..[]....##\n'
#                   '##..[]....####..[][]........####..........##..........[]..........[][]..[]....##..##[][]##[][]..[]##\n'
#                   '####################################################################################################',
#   'final_map': '####################################################################################################\n'
#                '##[]..[]..[]..[]......[][][][][][]##[][][][]....[].[][][].##.[][]..[][].....[][]..[][]..[][]......##\n'
#                '##[]..[]..[].[][].......[][][][][].[][].............[][]##[].[]....[][].......##..[][]..[][][]....##\n'
#                '##.[][][]..............[][][][]....[]....................[].........................[][][][]......##\n'
#                '##..................##...[].....##[]..........................[]....................##.......[].####\n'
#                '##........[]....................##.......[]...[]......##......[][]........##........##.[].[]....####\n'
#                '##..[]..##[]........[]..........[]............##....##[]......[]####......[]##[]...[]........[].[]##\n'
#                '##.......[].####...[]..[].......##............##...[].........##[]..........[]....[]..[]....[]....##\n'
#                '##..##@.........[][]####[]......[][].........[][]............[][]..........[].....##..##....[]##..##\n'
#                '##..............##[]..##[]........[][].[]..............[].....[]......##..##...[]....[]...........##\n'
#                '##..##....##..[]......[][]....##.....[].[]............[].[][][][]...[]......[]##[]..............####\n'
#                '##..........[]......[][]##..........[][]......##........##[][]..[]..........##..##....##..........##\n'
#                '##[]##......[]..##[].[][]............[].............[]..##[][].[].......##..[]......[][]##........##\n'
#                '##..##....##......####[]..........######..[]......##.......[]...[]................[][][][]##..##[]##\n'
#                '####................[]..##...[].........[][].......[][].####.........[]...........[][]..........[]##\n'
#                '##............[]..[][]....................[][]........[]##[].....................[].[].........[].##\n'
#                '##..[][]......##..[].................[]..[][].........[][]....[].......[].........[][][][]....##..##\n'
#                '##....[]##....[]........[].[]..............[]........[].[]..............[]..[]##.[][]...##[][]....##\n'
#                '######[][]..[].....[][][].[]...[]...........##..........[]............[]....##....[]##[]..####[]..##\n'
#                '##..[][]........[]..##..##[][][]##.......[]...........[]...[].....[]##......[]##..[]..##..[][]....##\n'
#                '##....[]....................[]......[]..##[]##..[]..##.....[].............[]..[]..##..##....[]....##\n'
#                '##....[]......[]..........[][][]..[]...[][][][].......[][][]................####....[]..........[]##\n'
#                '##[]##..##....##....[]......[]##..####..##..[]##....##[]..[]........................[][]....####..##\n'
#                '##....[]....[]####[][]..##..##............##[]............[]................[]..[]..[]....##......##\n'
#                '##[][]....##............##..####[][][]..................................[][][]..[][][][]........[]##\n'
#                '##....[][][]....##......[][]....####[].[].......##....................##.[][].[][][]....[]..##..[]##\n'
#                '####......[][]................[]..##..[]##............[]...............[][]...##[][]..........[]####\n'
#                '##......##........[]..##....[][]..[]..[]..[]##..[]####.[][].....##....##[]......[].....[].[]....[]##\n'
#                '##[]..[][]....[]....[]..##..[]......[][]..##[].....[]...[].[]......[]..........[][][]..[].##..[][]##\n'
#                '##......[]......[]......[]........[]..[]..[]..[]..[]....##.[].....[]..........[]..[]......[]....[]##\n'
#                '##[][]##..##[]....[][][]..##[]..[]....[]......[].[].................[]......[]....[]..........[][]##\n'
#                '##......[][][][]..[][]##..............[][]..##........[]##....[]......[]....[]................[][]##\n'
#                '##[]..[]....[]....[][][]..[]......[][][]........[]....##[].........[].........[]..............[][]##\n'
#                '##..[]..[]....[][]##....##........[]..........................[]..[]##......[]..............##[]..##\n'
#                '##..[]....[][]..............[]............[]..............[]##[]..##[]..[][][]##[]...........[]...##\n'
#                '##................[][]..[]##....[]........[]..............##[][]........[]##[]##[]....[]..[]......##\n'
#                '##[]..##..##[]..........##....##....##..##....[]..##..[]##....[]##....##...[][][].........##......##\n'
#                '##[]##........[]..........[]..##..##[][]....[]....##..[]..................##[][][]................##\n'
#                '##[][]##....##..[][][][][]..............##........##..[]##[][][]..[].........[][]...[]..[]..##....##\n'
#                '##..[]##......[]..................[]..[]........[][].[]......[].....[]............[]..[][]........##\n'
#                '##....[]....[]##[]..[]..[][]..........[][][][].........[][][].[][]##[].....[].....[]##..[]##......##\n'
#                '##[][]..##[][][]............[]....##[][][][][]##........##.....[]...##....##.........[][][].......##\n'
#                '##..[]..[]##........##[]................[]....##[]..[]....[]..[]........[]................##......##\n'
#                '##..................[][]....[]............[]..............[][]####.....[]...................[][]..##\n'
#                '##........##..[]..[][]..[]..........##..[][]..[]....[]##...[]...........##..........##......[][][]##\n'
#                '##..[][]..........................##........[][]..##[][]............##....[]............[][][][][]##\n'
#                '##[]..[]..[]..................[]##....[][]..........[]............[]##[]..........[]....[]..[]..[]##\n'
#                '##......[][]......##[]..####[][][]........[]..........##[]..[]..[]....##[]........[][]##[]..[]..[]##\n'
#                '##..[]....####..[][]........####..........##..........[][]......[][][].[].....##[]##[][]##[][]..[]##\n'
#                '####################################################################################################',
#   'sum_of_boxes_GPS_coordinates': 1519991,
#   'elapsed_time_s': 0.014071583049371839}]